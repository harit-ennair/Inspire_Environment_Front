<div class="form-container">
  <div class="form-header">
    <button class="btn-back" (click)="router.navigate(['/admin/staff'])" title="Back to staff">
      ‚Üê Back
    </button>
    <h1>{{ isEdit() ? 'Edit Staff' : 'Create New Staff' }}</h1>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading staff data...</p>
    </div>
  }

  <!-- Form -->
  @if (!loading()) {
    <div class="form-card">
      <form (ngSubmit)="save()" #staffForm="ngForm">
        
        <!-- Position -->
        <div class="form-group">
          <label for="position" class="form-label">
            Position <span class="required">*</span>
          </label>
          <input
            type="text"
            id="position"
            name="position"
            class="form-input"
            [(ngModel)]="staff().position"
            required
            placeholder="Enter position (e.g., Professor, Coordinator)"
            #position="ngModel"
          />
          @if (position.invalid && (position.dirty || position.touched)) {
            <div class="error-text">
              Position is required
            </div>
          }
        </div>

        <!-- First Name -->
        <div class="form-group">
          <label for="firstName" class="form-label">
            First Name <span class="required">*</span>
          </label>
          <input
            type="text"
            id="firstName"
            name="firstName"
            class="form-input"
            [(ngModel)]="staff().user.firstName"
            required
            placeholder="Enter first name"
            #firstName="ngModel"
          />
          @if (firstName.invalid && (firstName.dirty || firstName.touched)) {
            <div class="error-text">
              First name is required
            </div>
          }
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="lastName" class="form-label">
            Last Name <span class="required">*</span>
          </label>
          <input
            type="text"
            id="lastName"
            name="lastName"
            class="form-input"
            [(ngModel)]="staff().user.lastName"
            required
            placeholder="Enter last name"
            #lastName="ngModel"
          />
          @if (lastName.invalid && (lastName.dirty || lastName.touched)) {
            <div class="error-text">
              Last name is required
            </div>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email" class="form-label">
            Email <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            class="form-input"
            [(ngModel)]="staff().user.email"
            required
            email
            placeholder="Enter email address"
            #email="ngModel"
          />
          @if (email.invalid && (email.dirty || email.touched)) {
            <div class="error-text">
              @if (email.errors?.['required']) {
                Email is required
              }
              @if (email.errors?.['email']) {
                Please enter a valid email
              }
            </div>
          }
        </div>

        <!-- Role -->
        <div class="form-group">
          <label for="roleId" class="form-label">
            Role <span class="required">*</span>
          </label>
          <select
            id="roleId"
            name="roleId"
            class="form-select"
            [(ngModel)]="staff().user.roleId"
            required
            #roleId="ngModel"
          >
            <option [ngValue]="null">Select a role</option>
            @for (role of roles(); track role.id) {
              <option [ngValue]="role.id">{{ role.name }}</option>
            }
          </select>
          @if (roleId.invalid && (roleId.dirty || roleId.touched)) {
            <div class="error-text">
              Role is required
            </div>
          }
        </div>

        <!-- Department -->
        <div class="form-group">
          <label for="departmentId" class="form-label">
            Department <span class="required">*</span>
          </label>
          <select
            id="departmentId"
            name="departmentId"
            class="form-select"
            [(ngModel)]="staff().user.departmentId"
            required
            #departmentId="ngModel"
          >
            <option [ngValue]="null">Select a department</option>
            @for (dept of departments(); track dept.id) {
              <option [ngValue]="dept.id">{{ dept.name }}</option>
            }
          </select>
          @if (departmentId.invalid && (departmentId.dirty || departmentId.touched)) {
            <div class="error-text">
              Department is required
            </div>
          }
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="button"
            class="btn-cancel"
            (click)="router.navigate(['/admin/staff'])"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn-submit"
            [disabled]="staffForm.invalid"
          >
            {{ isEdit() ? 'Update Staff' : 'Create Staff' }}
          </button>
        </div>
      </form>
    </div>
  }
</div>
